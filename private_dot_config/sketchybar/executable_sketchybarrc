#!/bin/bash

# SketchyBar configuration for AeroSpace integration

PLUGIN_DIR="$CONFIG_DIR/plugins"

# Bar appearance (height=40 to fill notch area on MacBook)
# Color: Tokyo Night background #1a1b26 with 0.85 opacity (0xd9)
sketchybar --bar height=40 \
                 blur_radius=20 \
                 position=top \
                 sticky=on \
                 padding_left=10 \
                 padding_right=10 \
                 color=0xd91a1b26

# Default settings for items
sketchybar --default icon.font="SF Pro:Semibold:14.0" \
                     icon.color=0xffffffff \
                     label.font="SF Pro:Semibold:14.0" \
                     label.color=0xffffffff \
                     padding_left=5 \
                     padding_right=5

# Register aerospace workspace change event
sketchybar --add event aerospace_workspace_change

# Add workspace items for each AeroSpace workspace
for sid in $(aerospace list-workspaces --all); do
    sketchybar --add item space.$sid left \
        --subscribe space.$sid aerospace_workspace_change \
        --set space.$sid \
        background.color=0x44ffffff \
        background.corner_radius=6 \
        background.height=24 \
        background.drawing=off \
        icon.font="JetBrainsMono Nerd Font:Bold:12.0" \
        icon.drawing=off \
        icon.padding_left=6 \
        icon.padding_right=0 \
        label="$sid" \
        label.font="JetBrainsMono Nerd Font:Bold:12.0" \
        label.padding_left=4 \
        label.padding_right=6 \
        padding_left=2 \
        padding_right=2 \
        click_script="aerospace workspace $sid" \
        script="$PLUGIN_DIR/aerospace.sh $sid"
done

# Add a separator
sketchybar --add item separator left \
           --set separator icon="|" \
                           icon.color=0x44ffffff \
                           label.drawing=off \
                           padding_left=10 \
                           padding_right=10

# Front app indicator
sketchybar --add item front_app left \
           --set front_app icon.drawing=off \
                           script="$PLUGIN_DIR/front_app.sh" \
           --subscribe front_app front_app_switched

# Clock on the right
sketchybar --add item clock right \
           --set clock update_freq=10 \
                       script="$PLUGIN_DIR/clock.sh"

# Force update on startup
sketchybar --update

# Initialize: highlight the currently focused workspace
FOCUSED=$(aerospace list-workspaces --focused)
sketchybar --trigger aerospace_workspace_change FOCUSED_WORKSPACE=$FOCUSED
